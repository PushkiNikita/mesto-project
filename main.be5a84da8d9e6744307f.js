(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},t={link:"https://mesto.nomoreparties.co/v1/apf-cohort-202/",headers:{authorization:"1d2f02e3-63ff-470c-96c1-744c1094e49b","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var n=function(t){var r=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);o(r,n),r.forEach((function(c){c.addEventListener("input",(function(){(function(t,r){r.validity.valid?function(t,r){var n=t.querySelector("#input-".concat(r.id,"-error"));r.classList.remove(e.inputErrorClass),n.classList.remove(e.errorClass),n.textContent=""}(t,r):function(t,r,n){var o=t.querySelector("#input-".concat(r.id,"-error"));r.classList.add(e.inputErrorClass),o.textContent=n,o.classList.add(e.errorClass)}(t,r,r.validationMessage)})(t,c),o(r,n)}))}))},o=function(t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(r.classList.remove(e.inactiveButtonClass),r.removeAttribute("disabled")):(r.classList.add(e.inactiveButtonClass),r.setAttribute("disabled",!0))};function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",(function(t){return a(t,e)})),e.addEventListener("mousedown",(function(t){return i(t,e)}))}function u(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",(function(e){return a(e,t)})),t.removeEventListener("mousedown",(function(e){return i(e,t)}));var r,n,o,c=t.querySelector("form");c&&(c.reset(),r=c,n=Array.from(r.querySelectorAll(e.inputSelector)),o=r.querySelector(e.submitButtonSelector),n.forEach((function(t){t.classList.remove(e.inputErrorClass);var n=r.querySelector("#input-".concat(t.id,"-error"));n&&(n.textContent="",n.classList.remove(e.errorClass))})),o&&(o.classList.add(e.inactiveButtonClass),o.disabled=!0),c.querySelectorAll(".popup__input").forEach((function(t){t.classList.remove(e.inputErrorClass)})),c.querySelectorAll(".popup__error").forEach((function(t){t.textContent="",t.classList.remove(e.errorClass)})))}var a=function(e,t){"Escape"===e.key&&u(t)},i=function(e,t){e.target===e.currentTarget&&u(t)};function s(e,n){var o=e.name,a=e.link,i=e.likes,s=e._id,d=e.owner,p=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),f=document.querySelector(".popup_type_delete-card"),_=f.querySelector(".popup__button"),v=p.querySelector(".card__title"),m=p.querySelector(".card__image"),y=p.querySelector(".card__like-button"),h=p.querySelector(".card__likes-count"),S=p.querySelector(".card__delete-button");return v.textContent=o,m.src=a,m.alt=o,l(y,h,i,n),y.addEventListener("click",(function(){var e;(y.classList.contains("card__like-button_is-active")?(e=s,fetch("".concat(t.link,"cards/").concat(e,"/likes"),{method:"DELETE",headers:t.headers}).then(r)):function(e){return fetch("".concat(t.link,"cards/").concat(e,"/likes"),{method:"PUT",headers:t.headers}).then(r)}(s)).then((function(e){l(y,h,e.likes,n)})).catch((function(e){return console.error("Ошибка при изменении лайка:",e)}))})),d._id!==n?S.remove():S.addEventListener("click",(function(){c(f);var e=function(e){e.preventDefault();var n,o=_.textContent;_.textContent="Удаление...",_.disabled=!0,(n=s,fetch("".concat(t.link,"cards/").concat(n),{method:"DELETE",headers:t.headers}).then(r)).then((function(){S.closest(".card").remove(),u(f)})).catch((function(e){return console.error("Ошибка при удалении карточки:",e)})).finally((function(){_.textContent=o,_.disabled=!1}))};_.removeEventListener("click",_._handler),_.addEventListener("click",e,{once:!0}),_._handler=e})),m.addEventListener("click",(function(){var e=document.querySelector(".popup__image"),t=document.querySelector(".popup__caption");e.src=a,e.alt=o,t.textContent=o,c(document.querySelector(".popup_type_image"))})),p}function l(e,t,r,n){t.textContent=r.length>0?r.length:"",r.some((function(e){return e._id===n}))?e.classList.add("card__like-button_is-active"):e.classList.remove("card__like-button_is-active")}var d,p=document.querySelector(".places__list"),f=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_avatar"),m=document.querySelectorAll(".popup"),y=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),S=document.querySelector(".profile__avatar-edit"),q=document.querySelectorAll(".popup__close"),E=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),L=f.querySelector(".popup__form"),k=L.querySelector(".popup__input_type_name"),x=L.querySelector(".popup__input_type_description"),A=_.querySelector(".popup__form"),g=_.querySelector(".popup__input_type_card-name"),T=_.querySelector(".popup__input_type_url"),B=v.querySelector(".popup__form"),w=v.querySelector(".popup__input_type_url");m.forEach((function(e){e.classList.add("popup_is-animated")})),function(e){e.forEach((function(e){e.addEventListener("click",(function(){var t=e.closest(".popup");t&&u(t)}))}))}(q),y.addEventListener("click",(function(){k.value=E.textContent,x.value=C.textContent,c(f)})),L.addEventListener("submit",(function(n){n.preventDefault();var o=k.value,c=x.value,a=n.target.querySelector("button");a.textContent="Сохранение...",a.disabled=!0,function(e){var n=e.username,o=e.description;return fetch("".concat(t.link,"users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:o})}).then(r)}({username:o,description:c}).then((function(e){var t=e.name,r=e.about;E.textContent=t,C.textContent=r,u(f)})).catch((function(e){return console.error("Ошибка обновления профиля:",e)})).finally((function(){a.textContent="Сохранить",a.disabled=!1;var t=a.closest("form");t&&t.querySelectorAll(".popup__input").forEach((function(t){t.classList.remove(e.inputErrorClass)}))}))})),h.addEventListener("click",(function(){c(_)})),A.addEventListener("submit",(function(n){n.preventDefault();var o=g.value,c=T.value,a=n.target.querySelector("button");a.textContent="Сохранение...",a.disabled=!0,function(e){var n=e.name,o=e.link;return fetch("".concat(t.link,"cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:o})}).then(r)}({name:o,link:c}).then((function(e){var t=s(e,d);p.prepend(t),u(_),A.reset()})).catch((function(e){return console.error("Ошибка добавления карточки:",e)})).finally((function(){a.textContent="Сохранить",a.disabled=!1;var t=a.closest("form");t&&t.querySelectorAll(".popup__input").forEach((function(t){t.classList.remove(e.inputErrorClass)}))}))})),S.addEventListener("click",(function(){c(v)})),B.addEventListener("submit",(function(n){n.preventDefault();var o=w.value,c=n.target.querySelector("button");c.textContent="Сохранение...",c.disabled=!0,function(e){var n=e.avatar;return fetch("".concat(t.link,"users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then(r)}({avatar:o}).then((function(e){var t=e.avatar;b.src=t,u(v),B.reset()})).catch((function(e){return console.error("Ошибка изменения аватара:",e)})).finally((function(){c.textContent="Сохранить",c.disabled=!1;var t=c.closest("form");t&&t.querySelectorAll(".popup__input").forEach((function(t){t.classList.remove(e.inputErrorClass)}))}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){n(e)}))}(e),fetch("".concat(t.link,"users/me"),{headers:t.headers}).then(r).then((function(e){var t=e.name,r=e.about,n=e.avatar,o=e._id;E.textContent=t,C.textContent=r,b.src=n,d=o})).catch((function(e){return console.error("Ошибка загрузки данных пользователя:",e)})),fetch("".concat(t.link,"cards"),{headers:t.headers}).then(r).then((function(e){e.forEach((function(e){var t=s(e,d);p.append(t)}))})).catch((function(e){return console.error("Ошибка загрузки карточек:",e)}))})();